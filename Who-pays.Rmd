---
title: "Who pays tariffs?"
author: "Mitsuo Shiota"
date: "2019-05-13"
output: 
  github_document:
    toc: TRUE
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
Updated: `r Sys.Date()`

## Summary

On May 11, 2019, Japanese newspaper Nikkei reported that China pays most of the tariffs by cutting export prices, basically confirming [the US President's tweet](https://twitter.com/realDonaldTrump/status/1126815126584266753). I was surprised, as [US import price index: China](https://fred.stlouisfed.org/series/CHNTOT) has not yet declined so much. So I have decided to check how US import prices from China changed from 2018 Q2, just before the first tranche "34b" became effective, for each HTS 10 digit code item, and compare the changes by tariff schedule category.

Result: Although the median price of the first tranche "34b" has dropped approximately 8 percent more than non-tariff levied items ("rest") since 2019 Q1, the others ("16b" and "200b") have dropped less than 1 percent more than "rest". This suggests China pays a third of tariffs in "34b", and nothing in "16b" and "200b". I can't confirm the Nikkei report.

## Libraries and functions

Looking at [census data page](https://api.census.gov/data/timeseries/intltrade/imports/hs/variables.html), I decide to select "GEN_VAL_MO" as value, and "CON_QY1_MO" as quantity, though I selected "GEN_CIF_MO" as value in [the original analysis](README.md).

```{r libraries, include=FALSE}
# Libraries
library(tidyverse)

# Function
# get country import data by year
import_from_country <- function(country, year) {
  df <- censusapi::getCensus(
    name = "timeseries/intltrade/imports/hs",
    key = keyring::key_get("census"),
    vars = c("I_COMMODITY", "GEN_VAL_MO", "CON_QY1_MO", "UNIT_QY1"),
    time = year,
    CTY_CODE = country,
    COMM_LVL = "HS10"
    )
  
  df$GEN_VAL_MO <- as.numeric(df$GEN_VAL_MO)
  df$CON_QY1_MO <- as.numeric(df$CON_QY1_MO)
    
  df$time <- as.Date(paste0(df$time, "-01"), "%Y-%m-%d")
    
  df %>% 
    rename(
      hs = I_COMMODITY,
      value = GEN_VAL_MO,
      quantity = CON_QY1_MO
    ) %>% 
    select(time, hs, value, quantity) %>% 
    arrange(hs, time)
}

```

## Extract HTS 8 digit codes for "34b", "16b", "200b", "300b_a" and "300b_c",
## and 10 digit codes for "excl"

I load tariff lists I have saved in [the original analysis](README.md).

```{r load_tariff_list, echo=FALSE, results="hide", cache=FALSE}
# load data
load("data/tariff_list.rdata")

```

## Get monthly import data

```{r API_Key_input, include=FALSE}
keyring::key_set("census")

```

```{r get_data, echo=FALSE, warning=FALSE, cache=FALSE}
df2018 <- import_from_country(5700, 2018)
df2019 <- import_from_country(5700, 2019)

df_china <- df2018 %>% 
  bind_rows(df2019)

```

The number of HTS 10 digit code items are `r df_china$hs %>% unique() %>% length()`.

## Transform into quarterly data

I change data from monthly to quarterly, as I have to drop so many data to calculate unit price as value divided by quantity in monthly data. I index unit price as of 2018 2Q equals to one, and add tariff schedule category ("34b", "16b", "200b", "rest") to each item.

```{r transform_quarterly, echo=FALSE}

df_q <- df_china %>%
  mutate(
    quarter = zoo::as.yearqtr(time)
  ) %>% 
  group_by(hs, quarter) %>% 
  summarize(
    value = sum(value),
    quantity = sum(quantity)
  ) %>% 
  mutate(unit_price = value / quantity)

temp <- df_q %>% 
  filter(quarter == "2018 Q2") %>% 
  select(hs, unit_price)

df_q <- df_q %>% 
  left_join(temp, by = "hs") %>% 
  mutate(index = unit_price.x / unit_price.y) %>% 
  drop_na(index) %>% 
  filter(index < Inf)

df_q <- df_q %>% 
  mutate(hs8 = str_sub(hs, start = 1L, end = 8L))

# add category
df_c <- df_q %>% 
  left_join(df_list_34b, by = "hs8") %>% 
  left_join(df_list_16b, by = "hs8") %>% 
  left_join(df_list_200b, by = "hs8") %>% 
  left_join(df_list_excl, by = "hs") %>% 
  mutate(
    category_old = if_else(!is.na(tariff.x), "34b",
                       if_else(!is.na(tariff.y), "16b",
                               if_else(!is.na(tariff.x.x), "200b", "rest"))),
    category = if_else(!is.na(tariff.y.y), "excl", category_old)
  ) %>% 
  select(-starts_with("tariff"), -category_old)

df_c$category <- factor(df_c$category, 
                            levels = c("34b", "16b", "200b", "excl", "rest"))


```

Now, the number of HTS 10 digit code items are `r df_q$hs %>% unique() %>% length()`.

## Look at the price changes from 2018 Q2

```{r 2018Q2, echo=FALSE}
medians <- vector("list", length = 5)

df_2018Q2 <- df_c %>% 
  filter(quarter == "2018 Q2")

medians[[1]] <- df_2018Q2 %>% 
  group_by(quarter, category) %>% 
  summarize(median = median(index))

base <- medians[[1]][medians[[1]]$category == "rest", "median"] %>% as.numeric()

medians[[1]] <- medians[[1]] %>% 
  mutate(diff_rest = median - base)

```

Look at 2018 Q3. In some non-commodity items, products are so different, and it is difficult to interpret value per quantity changes as price changes. So I think we had better ignore outliers, and look at the medians of price indices by each category.

As “34b”, “16b”, “200b” imposed tariffs got effective on July 6, 2018, August 23, 2018, and September 24, 2018, nothing happened in the medians of price indices in 2018 Q3.

Suppose "rest" is the base line, then the differeces with "rest" ("diff_rest") are the tariff effects on median import prices by each category.

```{r boxplot_2018_Q3, echo=FALSE}
df_2018Q3 <- df_c %>% 
  filter(quarter == "2018 Q3")

df_2018Q3 %>% 
  group_by(category) %>% 
  count()

medians[[2]] <- df_2018Q3 %>% 
  group_by(quarter, category) %>% 
  summarize(median = median(index))

base <- medians[[2]][medians[[2]]$category == "rest", "median"] %>% as.numeric()

medians[[2]] <- medians[[2]] %>% 
  mutate(diff_rest = median - base)

medians[[2]]

df_2018Q3 %>% 
  ggplot(aes(x = category, y = index)) +
  geom_boxplot() +
  coord_cartesian(ylim = c(0, 2)) +
  labs(
    title = "Price index as of 2018 Q3",
    x ="", y = "index (2018 Q2 = 1)"
  )


```

Look at 2018 Q4. Nothing significant happened.

```{r boxplot_2018_Q4, echo=FALSE}
df_2018Q4 <- df_c %>% 
  filter(quarter == "2018 Q4")

df_2018Q4 %>% 
  group_by(category) %>% 
  count()

medians[[3]] <- df_2018Q4 %>% 
  group_by(quarter, category) %>% 
  summarize(median = median(index))

base <- medians[[3]][medians[[3]]$category == "rest", "median"] %>% as.numeric()

medians[[3]] <- medians[[3]] %>% 
  mutate(diff_rest = median - base)

medians[[3]]

df_2018Q4 %>% 
  ggplot(aes(x = category, y = index)) +
  geom_boxplot() +
  coord_cartesian(ylim = c(0, 2)) +
  labs(
    title = "Price index as of 2018 Q4",
    x ="", y = "index (2018 Q2 = 1)"
  )

```

Look at 2019 Q1. Now "34b" median price index is 8 percent lower than "rest". Approximately a third (8 out of 25) of imposed tariffs in "34b" can be intrepreted being paid by Chinese exporters. As for "16b" and "200b", Chinese exporters pay almost nothing.

```{r boxplot_2019_Q1, echo=FALSE}
df_2019Q1 <- df_c %>% 
  filter(quarter == "2019 Q1")

df_2019Q1 %>% 
  group_by(category) %>% 
  count()

medians[[4]] <- df_2019Q1 %>% 
  group_by(quarter, category) %>% 
  summarize(median = median(index))

base <- medians[[4]][medians[[4]]$category == "rest", "median"] %>% as.numeric()

medians[[4]] <- medians[[4]] %>% 
  mutate(diff_rest = median - base)

medians[[4]]

df_2019Q1 %>% 
  ggplot(aes(x = category, y = index)) +
  geom_boxplot() +
  coord_cartesian(ylim = c(0, 2)) +
  labs(
    title = "Price index as of 2019 Q1",
    x ="", y = "index (2018 Q2 = 1)"
  )

```

Look at 2019 Q2. We can see the same pattern as 2019 Q1. As for "34b", Chinese exporters pay approximately 8 percent out of imposed 25 percent tariffs. As for "16b" and "200b", they pay less than 1 percent.

```{r boxplot_2019_Q2, echo=FALSE}
df_2019Q2 <- df_c %>% 
  filter(quarter == "2019 Q2")

df_2019Q2 %>% 
  group_by(category) %>% 
  count()

medians[[5]] <- df_2019Q2 %>% 
  group_by(quarter, category) %>% 
  summarize(median = median(index))

base <- medians[[5]][medians[[5]]$category == "rest", "median"] %>% as.numeric()

medians[[5]] <- medians[[5]] %>% 
  mutate(diff_rest = median - base)

medians[[5]]

df_2019Q2 %>% 
  ggplot(aes(x = category, y = index)) +
  geom_boxplot() +
  coord_cartesian(ylim = c(0, 2)) +
  labs(
    title = "Price index as of 2019 Q2",
    x ="", y = "index (2018 Q2 = 1)"
  )

```

Look at the differeces with "rest" ("diff_rest") movement. "34b" appears to be depressed by approximately 8 percent from 2019 1Q. "16b" and "200b" prices are also depressed somewhat, but less than 1 percent in 2019 2Q. Most of "excl" were parts of "34b", and its prices fell in 2019 1Q, but are expected to recover since exclusion.

```{r line_chart, echo=FALSE, warning=FALSE}
medians <- bind_rows(medians)

medians$quarter <- zoo::as.yearqtr(medians$quarter)

medians %>% 
  ggplot(aes(x = quarter, y = diff_rest,
             color = fct_reorder2(category, quarter, diff_rest))) +
  zoo::scale_x_yearqtr(format = "%Y %qQ") +
  geom_line() +
  labs(
    title = "Tariff effects on median import prices by category",
    x = "", y = "Differences with rest", color = ""
  )


```

EOL